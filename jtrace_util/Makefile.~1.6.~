PWD := $(shell pwd)
                                                                                                                                      
ifeq ($(MAIN_TOP_DIR),)
export MAIN_TOP_DIR := $(PWD)/../../../..
endif
                                                                                                                                      
include $(MAIN_TOP_DIR)/io64-src/src/make_gnu.master

UTIL_INST_DIR:=/usr/bin

ifeq ("$(KREL)","2.4")
APP_KREL=24
else
APP_KREL=26
endif

USER_CFLAGS += -DAPP_KREL=$(APP_KREL)

INCLUDE_FLAGS=-I ../include

psi_kutil-objs := psi_kutil.o 

all: psi_kutil

# Default rule to compile .c files into .o files for source files in 
# local directory
%.o : %.c Makefile
	@echo $@
	$(CC) $(INCLUDE_FLAGS) $(USER_CFLAGS) -o $@ -c $<

psi_kutil: $(psi_kutil-objs)
	@echo $@ 
	$(CC) -o $@ $(psi_kutil-objs)

$(INSTDIR)/psi_devfile_helper: psi_devfile_helper.sh 
	cp psi_devfile_helper.sh $(INSTDIR)/psi_devfile_helper
	@chmod +x $(INSTDIR)/psi_devfile_helper

$(INSTDIR)/psi_kutil: psi_kutil
	cp psi_kutil $(INSTDIR)
	@chmod +x $(INSTDIR)/psi_kutil
	

install: $(INSTDIR)/psi_kutil $(INSTDIR)/psi_devfile_helper

uninstall:
	@echo "Uninstall"
	@rm -f $(UTIL_INST_DIR)/psi_kutil 
	@rm -f $(INSTDIR)/psi_devfile_helper

modload:

modunload:

indent:
	@$(INDENT)

indent_clean:
	@rm -f *.$(INDENT_BACKUP_SUFFIX)	

clean-files += psi_kutil
clean:
	rm -rf $(clean-files)
	rm -f $(INSTDIR)/psi_kutil $(INSTDIR)/psi_devfile_helper
